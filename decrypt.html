<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gi·∫£i m√£ AES</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    .container { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    h2 { text-align: center; }
    input, button { width: 100%; padding: 10px; margin-top: 10px; box-sizing: border-box; font-size: 1em; }
    #result { margin-top: 20px; background: #eef; padding: 10px; border-left: 4px solid #007bff; word-break: break-word; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üîê Gi·∫£i m√£ AES</h2>
    <label for="key">Nh·∫≠p key (16 k√Ω t·ª±):</label>
    <input type="text" id="key" placeholder="Nh·∫≠p kh√≥a gi·∫£i m√£">
    <button onclick="decrypt()">Gi·∫£i m√£</button>
    <div id="result"></div>
  </div>

  <!-- Th∆∞ vi·ªán CryptoJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script>
     function decryptAES(cipherBase64, password) {
    try {
        // üîë Hash password b·∫±ng SHA256 r·ªìi l·∫•y 16 byte ƒë·∫ßu (AES-128)
        const fullKey = CryptoJS.SHA256(password); // 256-bit
        const key = CryptoJS.lib.WordArray.create(fullKey.words.slice(0, 4)); // 128-bit (16 bytes)

        // üîÑ IV c·ªë ƒë·ªãnh
        const iv = CryptoJS.enc.Utf8.parse("loinhovaodoi2025");

        // üì¶ Gi·∫£i m√£
        const decrypted = CryptoJS.AES.decrypt(cipherBase64, key, {
            iv: iv,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.Pkcs7
        });

        // üîç K·∫øt qu·∫£ chu·ªói UTF-8
        const plainText = decrypted.toString(CryptoJS.enc.Utf8);
        if (!plainText) throw "Sai key ho·∫∑c d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá";

        return plainText;

    } catch (err) {
        return "‚ùå Gi·∫£i m√£ th·∫•t b·∫°i: " + err;
    }
}

    function decrypt() {
      const key = document.getElementById("key").value.trim();
      let data = new URLSearchParams(window.location.search).get("data");
      data=decodeURIComponent(data);    
      const resultDiv = document.getElementById("result");
      if (!data || !key) {
        resultDiv.innerText = "‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß d·ªØ li·ªáu v√† kh√≥a.";
        return;
      }

      try {
        const decrypted = decryptAES(data, key);
        resultDiv.innerText = decrypted || "‚ö†Ô∏è Kh√≥a sai ho·∫∑c d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá!";
      } catch (e) {
        resultDiv.innerText = "‚ùå Gi·∫£i m√£ th·∫•t b·∫°i: " + e.message;
      }
    }
  </script>
</body>
</html>
